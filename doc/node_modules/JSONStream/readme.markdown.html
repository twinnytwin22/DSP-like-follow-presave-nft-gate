<!DOCTYPE html>
<html>
<head>
  <title>readme.markdown</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/JSONStream/readme.markdown";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#jsonstream">JSONStream</a>
      </div>

      <div class="heading h2">
        <a href="#install">install</a>
      </div>

      <div class="heading h2">
        <a href="#example">example</a>
      </div>

      <div class="heading h2">
        <a href="#jsonstream.parse-path">JSONStream.parse(path)</a>
      </div>

      <div class="heading h3">
        <a href="#examples">Examples</a>
      </div>

      <div class="heading h3">
        <a href="#recursive-patterns..">recursive patterns (..)</a>
      </div>

      <div class="heading h2">
        <a href="#jsonstream.parse-pattern-map">JSONStream.parse(pattern, map)</a>
      </div>

      <div class="heading h2">
        <a href="#jsonstream.stringify-open-sep-close">JSONStream.stringify(open, sep, close)</a>
      </div>

      <div class="heading h2">
        <a href="#jsonstream.stringifyobject-open-sep-close">JSONStream.stringifyObject(open, sep, close)</a>
      </div>

      <div class="heading h2">
        <a href="#unix-tool">unix tool</a>
      </div>

      <div class="heading h2">
        <a href="#numbers">numbers</a>
      </div>

      <div class="heading h2">
        <a href="#acknowlegements">Acknowlegements</a>
      </div>

      <div class="heading h2">
        <a href="#license">license</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="docs markdown"><div class="pilwrap" id="jsonstream">
  <h1>
    <a href="#jsonstream" name="jsonstream" class="pilcrow"></a>
JSONStream
  </h1>
</div>
<p>streaming JSON.parse and stringify</p>
<p><img src="https://secure.travis-ci.org/dominictarr/JSONStream.png?branch=master" alt=""></p>
<div class="pilwrap" id="install">
  <h2>
    <a href="#install" name="install" class="pilcrow"></a>
install
  </h2>
</div>
<p><code>npm install JSONStream</code></p>
<div class="pilwrap" id="example">
  <h2>
    <a href="#example" name="example" class="pilcrow"></a>
example
  </h2>
</div>
<pre><code class="js">
<span class="hljs-keyword">var</span> request = <span class="hljs-built_in">require</span>(<span class="hljs-string">'request'</span>)
  , JSONStream = <span class="hljs-built_in">require</span>(<span class="hljs-string">'JSONStream'</span>)
  , es = <span class="hljs-built_in">require</span>(<span class="hljs-string">'event-stream'</span>)

request({<span class="hljs-attr">url</span>: <span class="hljs-string">'http://isaacs.couchone.com/registry/_all_docs'</span>})
  .pipe(JSONStream.parse(<span class="hljs-string">'rows.*'</span>))
  .pipe(es.mapSync(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>{
    <span class="hljs-built_in">console</span>.error(data)
    <span class="hljs-keyword">return</span> data
  }))
</code></pre>
<div class="pilwrap" id="jsonstream.parse-path">
  <h2>
    <a href="#jsonstream.parse-path" name="jsonstream.parse-path" class="pilcrow"></a>
JSONStream.parse(path)
  </h2>
</div>
<p>parse stream of values that match a path</p>
<pre><code class="js">  JSONStream.parse(<span class="hljs-string">'rows.*.doc'</span>)
</code></pre>
<p>The <code>..</code> operator is the recursive descent operator from <a href="http://goessner.net/articles/JsonPath/">JSONPath</a>, which will match a child at any depth (see examples below).</p>
<p>If your keys have keys that include <code>.</code> or <code>*</code> etc, use an array instead.
<code>['row', true, /^doc/]</code>.</p>
<p>If you use an array, <code>RegExp</code>s, booleans, and/or functions. The <code>..</code> operator is also available in array representation, using <code>{recurse: true}</code>.
any object that matches the path will be emitted as 'data' (and <code>pipe</code>d down stream)</p>
<p>If <code>path</code> is empty or null, no 'data' events are emitted.</p>
<p>If you want to have keys emitted, you can prefix your <code>*</code> operator with <code>$</code>: <code>obj.$*</code> - in this case the data passed to the stream is an object with a <code>key</code> holding the key and a <code>value</code> property holding the data.</p>
<div class="pilwrap" id="examples">
  <h3>
    <a href="#examples" name="examples" class="pilcrow"></a>
Examples
  </h3>
</div>
<p>query a couchdb view:</p>
<pre><code class="bash">curl -sS localhost:5984/tests/_all_docs&amp;include_docs=<span class="hljs-literal">true</span>
</code></pre>
<p>you will get something like this:</p>
<pre><code class="js">{<span class="hljs-string">"total_rows"</span>:<span class="hljs-number">129</span>,<span class="hljs-string">"offset"</span>:<span class="hljs-number">0</span>,<span class="hljs-string">"rows"</span>:[
  { <span class="hljs-string">"id"</span>:<span class="hljs-string">"change1_0.6995461115147918"</span>
  , <span class="hljs-string">"key"</span>:<span class="hljs-string">"change1_0.6995461115147918"</span>
  , <span class="hljs-string">"value"</span>:{<span class="hljs-string">"rev"</span>:<span class="hljs-string">"1-e240bae28c7bb3667f02760f6398d508"</span>}
  , <span class="hljs-string">"doc"</span>:{
      <span class="hljs-string">"_id"</span>:  <span class="hljs-string">"change1_0.6995461115147918"</span>
    , <span class="hljs-string">"_rev"</span>: <span class="hljs-string">"1-e240bae28c7bb3667f02760f6398d508"</span>,<span class="hljs-string">"hello"</span>:<span class="hljs-number">1</span>}
  },
  { <span class="hljs-string">"id"</span>:<span class="hljs-string">"change2_0.6995461115147918"</span>
  , <span class="hljs-string">"key"</span>:<span class="hljs-string">"change2_0.6995461115147918"</span>
  , <span class="hljs-string">"value"</span>:{<span class="hljs-string">"rev"</span>:<span class="hljs-string">"1-13677d36b98c0c075145bb8975105153"</span>}
  , <span class="hljs-string">"doc"</span>:{
      <span class="hljs-string">"_id"</span>:<span class="hljs-string">"change2_0.6995461115147918"</span>
    , <span class="hljs-string">"_rev"</span>:<span class="hljs-string">"1-13677d36b98c0c075145bb8975105153"</span>
    , <span class="hljs-string">"hello"</span>:<span class="hljs-number">2</span>
    }
  },
]}

</code></pre>
<p>we are probably most interested in the <code>rows.*.doc</code></p>
<p>create a <code>Stream</code> that parses the documents from the feed like this:</p>
<pre><code class="js"><span class="hljs-keyword">var</span> stream = JSONStream.parse([<span class="hljs-string">'rows'</span>, <span class="hljs-literal">true</span>, <span class="hljs-string">'doc'</span>]) <span class="hljs-comment">//rows, ANYTHING, doc</span>

stream.on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'received:'</span>, data);
});
<span class="hljs-comment">//emits anything from _before_ the first match</span>
stream.on(<span class="hljs-string">'header'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'header:'</span>, data) <span class="hljs-comment">// =&gt; {"total_rows":129,"offset":0}</span>
})

</code></pre>
<p>awesome!</p>
<p>In case you wanted the contents the doc emitted:</p>
<pre><code class="js"><span class="hljs-keyword">var</span> stream = JSONStream.parse([<span class="hljs-string">'rows'</span>, <span class="hljs-literal">true</span>, <span class="hljs-string">'doc'</span>, {<span class="hljs-attr">emitKey</span>: <span class="hljs-literal">true</span>}]) <span class="hljs-comment">//rows, ANYTHING, doc, items in docs with keys</span>

stream.on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'key:'</span>, data.key);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'value:'</span>, data.value);
});

</code></pre>
<p>You can also emit the path:</p>
<pre><code class="js"><span class="hljs-keyword">var</span> stream = JSONStream.parse([<span class="hljs-string">'rows'</span>, <span class="hljs-literal">true</span>, <span class="hljs-string">'doc'</span>, {<span class="hljs-attr">emitPath</span>: <span class="hljs-literal">true</span>}]) <span class="hljs-comment">//rows, ANYTHING, doc, items in docs with keys</span>

stream.on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'path:'</span>, data.path);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'value:'</span>, data.value);
});

</code></pre>
<div class="pilwrap" id="recursive-patterns..">
  <h3>
    <a href="#recursive-patterns.." name="recursive-patterns.." class="pilcrow"></a>
recursive patterns (..)
  </h3>
</div>
<p><code>JSONStream.parse('docs..value')</code>
(or <code>JSONStream.parse(['docs', {recurse: true}, 'value'])</code> using an array)
will emit every <code>value</code> object that is a child, grand-child, etc. of the
<code>docs</code> object. In this example, it will match exactly 5 times at various depth
levels, emitting 0, 1, 2, 3 and 4 as results.</p>
<pre><code class="js">{
  <span class="hljs-string">"total"</span>: <span class="hljs-number">5</span>,
  <span class="hljs-string">"docs"</span>: [
    {
      <span class="hljs-string">"key"</span>: {
        <span class="hljs-string">"value"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-string">"some"</span>: <span class="hljs-string">"property"</span>
      }
    },
    {<span class="hljs-string">"value"</span>: <span class="hljs-number">1</span>},
    {<span class="hljs-string">"value"</span>: <span class="hljs-number">2</span>},
    {<span class="hljs-string">"blbl"</span>: [{}, {<span class="hljs-string">"a"</span>:<span class="hljs-number">0</span>, <span class="hljs-string">"b"</span>:<span class="hljs-number">1</span>, <span class="hljs-string">"value"</span>:<span class="hljs-number">3</span>}, <span class="hljs-number">10</span>]},
    {<span class="hljs-string">"value"</span>: <span class="hljs-number">4</span>}
  ]
}
</code></pre>
<div class="pilwrap" id="jsonstream.parse-pattern-map">
  <h2>
    <a href="#jsonstream.parse-pattern-map" name="jsonstream.parse-pattern-map" class="pilcrow"></a>
JSONStream.parse(pattern, map)
  </h2>
</div>
<p>provide a function that can be used to map or filter
the json output. <code>map</code> is passed the value at that node of the pattern,
if <code>map</code> return non-nullish (anything but <code>null</code> or <code>undefined</code>)
that value will be emitted in the stream. If it returns a nullish value,
nothing will be emitted.</p>
<p><code>JSONStream</code> also emits <code>'header'</code> and <code>'footer'</code> events,
the <code>'header'</code> event contains anything in the output that was before
the first match, and the <code>'footer'</code>, is anything after the last match.</p>
<div class="pilwrap" id="jsonstream.stringify-open-sep-close">
  <h2>
    <a href="#jsonstream.stringify-open-sep-close" name="jsonstream.stringify-open-sep-close" class="pilcrow"></a>
JSONStream.stringify(open, sep, close)
  </h2>
</div>
<p>Create a writable stream.</p>
<p>you may pass in custom <code>open</code>, <code>close</code>, and <code>seperator</code> strings.
But, by default, <code>JSONStream.stringify()</code> will create an array,
(with default options <code>open='[\n', sep='\n,\n', close='\n]\n'</code>)</p>
<p>If you call <code>JSONStream.stringify(false)</code>
the elements will only be seperated by a newline.</p>
<p>If you only write one item this will be valid JSON.</p>
<p>If you write many items,
you can use a <code>RegExp</code> to split it into valid chunks.</p>
<div class="pilwrap" id="jsonstream.stringifyobject-open-sep-close">
  <h2>
    <a href="#jsonstream.stringifyobject-open-sep-close" name="jsonstream.stringifyobject-open-sep-close" class="pilcrow"></a>
JSONStream.stringifyObject(open, sep, close)
  </h2>
</div>
<p>Very much like <code>JSONStream.stringify</code>,
but creates a writable stream for objects instead of arrays.</p>
<p>Accordingly, <code>open='{\n', sep='\n,\n', close='\n}\n'</code>.</p>
<p>When you <code>.write()</code> to the stream you must supply an array with <code>[ key, data ]</code>
as the first argument.</p>
<div class="pilwrap" id="unix-tool">
  <h2>
    <a href="#unix-tool" name="unix-tool" class="pilcrow"></a>
unix tool
  </h2>
</div>
<p>query npm to see all the modules that browserify has ever depended on.</p>
<pre><code class="bash">curl https://registry.npmjs.org/browserify | JSONStream <span class="hljs-string">'versions.*.dependencies'</span>
</code></pre>
<div class="pilwrap" id="numbers">
  <h2>
    <a href="#numbers" name="numbers" class="pilcrow"></a>
numbers
  </h2>
</div>
<p>numbers will be emitted as numbers.
huge numbers that cannot be represented in memory as javascript numbers will be emitted as strings.
cf https://github.com/creationix/jsonparse/commit/044b268f01c4b8f97fb936fc85d3bcfba179e5bb for details.</p>
<div class="pilwrap" id="acknowlegements">
  <h2>
    <a href="#acknowlegements" name="acknowlegements" class="pilcrow"></a>
Acknowlegements
  </h2>
</div>
<p>this module depends on https://github.com/creationix/jsonparse
by Tim Caswell
and also thanks to Florent Jaby for teaching me about parsing with:
https://github.com/Floby/node-json-streams</p>
<div class="pilwrap" id="license">
  <h2>
    <a href="#license" name="license" class="pilcrow"></a>
license
  </h2>
</div>
<p>Dual-licensed under the MIT License or the Apache License, version 2.0</p>
</div>
  </div>
</body>
</html>
