<!DOCTYPE html>
<html>
<head>
  <title>next</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/.bin/next";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#sourcemappingurlnext.map">sourceMappingURL=next.map</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>next</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">#!/usr/bin/env node</span>
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-keyword">var</span> log = _interopRequireWildcard(<span class="hljs-built_in">require</span>(<span class="hljs-string">"../build/output/log"</span>));
<span class="hljs-keyword">var</span> _indexJs = _interopRequireDefault(<span class="hljs-built_in">require</span>(<span class="hljs-string">"next/dist/compiled/arg/index.js"</span>));
<span class="hljs-keyword">var</span> _constants = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../lib/constants"</span>);
<span class="hljs-keyword">var</span> _commands = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../lib/commands"</span>);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_interopRequireDefault</span>(<span class="hljs-params">obj</span>) </span>{
    <span class="hljs-keyword">return</span> obj &amp;&amp; obj.__esModule ? obj : {
        <span class="hljs-attr">default</span>: obj
    };
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_getRequireWildcardCache</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">WeakMap</span> !== <span class="hljs-string">"function"</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> cache = <span class="hljs-keyword">new</span> <span class="hljs-built_in">WeakMap</span>();
    _getRequireWildcardCache = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> cache;
    };
    <span class="hljs-keyword">return</span> cache;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_interopRequireWildcard</span>(<span class="hljs-params">obj</span>) </span>{
    <span class="hljs-keyword">if</span> (obj &amp;&amp; obj.__esModule) {
        <span class="hljs-keyword">return</span> obj;
    }
    <span class="hljs-keyword">if</span> (obj === <span class="hljs-literal">null</span> || <span class="hljs-keyword">typeof</span> obj !== <span class="hljs-string">"object"</span> &amp;&amp; <span class="hljs-keyword">typeof</span> obj !== <span class="hljs-string">"function"</span>) {
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">default</span>: obj
        };
    }
    <span class="hljs-keyword">var</span> cache = _getRequireWildcardCache();
    <span class="hljs-keyword">if</span> (cache &amp;&amp; cache.has(obj)) {
        <span class="hljs-keyword">return</span> cache.get(obj);
    }
    <span class="hljs-keyword">var</span> newObj = {};
    <span class="hljs-keyword">var</span> hasPropertyDescriptor = <span class="hljs-built_in">Object</span>.defineProperty &amp;&amp; <span class="hljs-built_in">Object</span>.getOwnPropertyDescriptor;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> obj){
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Object</span>.prototype.hasOwnProperty.call(obj, key)) {
            <span class="hljs-keyword">var</span> desc = hasPropertyDescriptor ? <span class="hljs-built_in">Object</span>.getOwnPropertyDescriptor(obj, key) : <span class="hljs-literal">null</span>;
            <span class="hljs-keyword">if</span> (desc &amp;&amp; (desc.get || desc.set)) {
                <span class="hljs-built_in">Object</span>.defineProperty(newObj, key, desc);
            } <span class="hljs-keyword">else</span> {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    <span class="hljs-keyword">if</span> (cache) {
        cache.set(obj, newObj);
    }
    <span class="hljs-keyword">return</span> newObj;
}
[
    <span class="hljs-string">"react"</span>,
    <span class="hljs-string">"react-dom"</span>
].forEach(<span class="hljs-function">(<span class="hljs-params">dependency</span>)=&gt;</span>{
    <span class="hljs-keyword">try</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>When 'npm link' is used it checks the clone location. Not the project.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-built_in">require</span>.resolve(dependency);
    } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-built_in">console</span>.warn(<span class="hljs-string">`The module '<span class="hljs-subst">${dependency}</span>' was not found. Next.js requires that you include it in 'dependencies' of your 'package.json'. To add it, run 'npm install <span class="hljs-subst">${dependency}</span>'`</span>);
    }
});
<span class="hljs-keyword">const</span> defaultCommand = <span class="hljs-string">"dev"</span>;
<span class="hljs-keyword">const</span> args = (<span class="hljs-number">0</span>, _indexJs).default({
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Types</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-string">"--version"</span>: <span class="hljs-built_in">Boolean</span>,
    <span class="hljs-string">"--help"</span>: <span class="hljs-built_in">Boolean</span>,
    <span class="hljs-string">"--inspect"</span>: <span class="hljs-built_in">Boolean</span>,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>Aliases</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-string">"-v"</span>: <span class="hljs-string">"--version"</span>,
    <span class="hljs-string">"-h"</span>: <span class="hljs-string">"--help"</span>
}, {
    <span class="hljs-attr">permissive</span>: <span class="hljs-literal">true</span>
});
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>Version is inlined into the file using taskr build pipeline</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">if</span> (args[<span class="hljs-string">"--version"</span>]) {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Next.js v<span class="hljs-subst">${<span class="hljs-string">"13.1.6"</span>}</span>`</span>);
    process.exit(<span class="hljs-number">0</span>);
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>Check if we are running <code>next &lt;subcommand&gt;</code> or <code>next</code></p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> foundCommand = <span class="hljs-built_in">Boolean</span>(_commands.commands[args._[<span class="hljs-number">0</span>]]);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>Makes sure the <code>next --help</code> case is covered
This help message is only showed for <code>next --help</code>
<code>next &lt;subcommand&gt; --help</code> falls through to be handled later</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">if</span> (!foundCommand &amp;&amp; args[<span class="hljs-string">"--help"</span>]) {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`
    Usage
      $ next &lt;command&gt;

    Available commands
      <span class="hljs-subst">${<span class="hljs-built_in">Object</span>.keys(_commands.commands).join(<span class="hljs-string">", "</span>)}</span>

    Options
      --version, -v   Version number
      --help, -h      Displays this message

    For more information run a command with the --help flag
      $ next build --help
  `</span>);
    process.exit(<span class="hljs-number">0</span>);
}
<span class="hljs-keyword">const</span> command = foundCommand ? args._[<span class="hljs-number">0</span>] : defaultCommand;
<span class="hljs-keyword">const</span> forwardedArgs = foundCommand ? args._.slice(<span class="hljs-number">1</span>) : args._;
<span class="hljs-keyword">if</span> (args[<span class="hljs-string">"--inspect"</span>]) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`--inspect flag is deprecated. Use env variable NODE_OPTIONS instead: NODE_OPTIONS='--inspect' next <span class="hljs-subst">${command}</span>`</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>Make sure the <code>next &lt;subcommand&gt; --help</code> case is covered</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">if</span> (args[<span class="hljs-string">"--help"</span>]) {
    forwardedArgs.push(<span class="hljs-string">"--help"</span>);
}
<span class="hljs-keyword">const</span> defaultEnv = command === <span class="hljs-string">"dev"</span> ? <span class="hljs-string">"development"</span> : <span class="hljs-string">"production"</span>;
<span class="hljs-keyword">const</span> standardEnv = [
    <span class="hljs-string">"production"</span>,
    <span class="hljs-string">"development"</span>,
    <span class="hljs-string">"test"</span>
];
<span class="hljs-keyword">if</span> (process.env.NODE_ENV) {
    <span class="hljs-keyword">const</span> isNotStandard = !standardEnv.includes(process.env.NODE_ENV);
    <span class="hljs-keyword">const</span> shouldWarnCommands = process.env.NODE_ENV === <span class="hljs-string">"development"</span> ? [
        <span class="hljs-string">"start"</span>,
        <span class="hljs-string">"build"</span>
    ] : process.env.NODE_ENV === <span class="hljs-string">"production"</span> ? [
        <span class="hljs-string">"dev"</span>
    ] : [];
    <span class="hljs-keyword">if</span> (isNotStandard || shouldWarnCommands.includes(command)) {
        log.warn(_constants.NON_STANDARD_NODE_ENV);
    }
}
process.env.NODE_ENV = process.env.NODE_ENV || defaultEnv;
process.env.NEXT_RUNTIME = <span class="hljs-string">"nodejs"</span>;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>x-ref: https://github.com/vercel/next.js/pull/34688#issuecomment-1047994505</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">if</span> (process.versions.pnp === <span class="hljs-string">"3"</span>) {
    <span class="hljs-keyword">const</span> nodeVersionParts = process.versions.node.split(<span class="hljs-string">"."</span>).map(<span class="hljs-function">(<span class="hljs-params">v</span>)=&gt;</span><span class="hljs-built_in">Number</span>(v));
    <span class="hljs-keyword">if</span> (nodeVersionParts[<span class="hljs-number">0</span>] &lt; <span class="hljs-number">16</span> || nodeVersionParts[<span class="hljs-number">0</span>] === <span class="hljs-number">16</span> &amp;&amp; nodeVersionParts[<span class="hljs-number">1</span>] &lt; <span class="hljs-number">14</span>) {
        log.warn(<span class="hljs-string">"Node.js 16.14+ is required for Yarn PnP 3.20+. More info: https://github.com/vercel/next.js/pull/34688#issuecomment-1047994505"</span>);
    }
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>Make sure commands gracefully respect termination signals (e.g. from Docker)
Allow the graceful termination to be manually configurable</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">if</span> (!process.env.NEXT_MANUAL_SIG_HANDLE &amp;&amp; command !== <span class="hljs-string">"dev"</span>) {
    process.on(<span class="hljs-string">"SIGTERM"</span>, ()=&gt;process.exit(<span class="hljs-number">0</span>));
    process.on(<span class="hljs-string">"SIGINT"</span>, ()=&gt;process.exit(<span class="hljs-number">0</span>));
}
_commands.commands[command]().then(<span class="hljs-function">(<span class="hljs-params">exec</span>)=&gt;</span>exec(forwardedArgs)).then(<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>{
    <span class="hljs-keyword">if</span> (command === <span class="hljs-string">"build"</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>ensure process exits after build completes so open handles/connections
don't cause process to hang</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        process.exit(<span class="hljs-number">0</span>);
    }
});

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="sourcemappingurlnext.map">
  <h1>
    <a href="#sourcemappingurlnext.map" name="sourcemappingurlnext.map" class="pilcrow"></a>
sourceMappingURL=next.map
  </h1>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"></pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
