<!DOCTYPE html>
<html>
<head>
  <title>ts-node</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/.bin/ts-node";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#sourcemappingurlbin.js.map">sourceMappingURL=bin.js.map</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>ts-node</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">#!/usr/bin/env node</span>
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">Object</span>.defineProperty(exports, <span class="hljs-string">"__esModule"</span>, { <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> });
exports.bootstrap = exports.main = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> path_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);
<span class="hljs-keyword">const</span> util_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"util"</span>);
<span class="hljs-keyword">const</span> Module = <span class="hljs-built_in">require</span>(<span class="hljs-string">"module"</span>);
<span class="hljs-keyword">let</span> arg;
<span class="hljs-keyword">const</span> util_2 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./util"</span>);
<span class="hljs-keyword">const</span> repl_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./repl"</span>);
<span class="hljs-keyword">const</span> index_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./index"</span>);
<span class="hljs-keyword">const</span> node_internal_modules_cjs_helpers_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../dist-raw/node-internal-modules-cjs-helpers"</span>);
<span class="hljs-keyword">const</span> spawn_child_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./child/spawn-child"</span>);
<span class="hljs-keyword">const</span> configuration_1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./configuration"</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>Main <code>bin</code> functionality.</p>
</div>
<div class="body">
<p>This file is split into a chain of functions (phases), each one adding to a shared state object.
This is done so that the next function can either be invoked in-process or, if necessary, invoked in a child process.</p>
<p>The functions are intentionally given uncreative names and left in the same order as the original code, to make a
smaller git diff.</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params">argv = process.argv.slice(<span class="hljs-number">2</span></span>), <span class="hljs-title">entrypointArgs</span> = </span>{}) {
    <span class="hljs-keyword">const</span> args = parseArgv(argv, entrypointArgs);
    <span class="hljs-keyword">const</span> state = {
        <span class="hljs-attr">shouldUseChildProcess</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">isInChildProcess</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">isCli</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">tsNodeScript</span>: __filename,
        <span class="hljs-attr">parseArgvResult</span>: args,
    };
    <span class="hljs-keyword">return</span> bootstrap(state);
}
exports.main = main;
<span class="hljs-comment">/** @internal */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bootstrap</span>(<span class="hljs-params">state</span>) </span>{
    <span class="hljs-keyword">if</span> (!state.phase2Result) {
        state.phase2Result = phase2(state);
        <span class="hljs-keyword">if</span> (state.shouldUseChildProcess &amp;&amp; !state.isInChildProcess) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Note: When transitioning into the child-process after <code>phase2</code>,
the updated working directory needs to be preserved.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, spawn_child_1.callInChild)(state);
        }
    }
    <span class="hljs-keyword">if</span> (!state.phase3Result) {
        state.phase3Result = phase3(state);
        <span class="hljs-keyword">if</span> (state.shouldUseChildProcess &amp;&amp; !state.isInChildProcess) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>Note: When transitioning into the child-process after <code>phase2</code>,
the updated working directory needs to be preserved.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, spawn_child_1.callInChild)(state);
        }
    }
    <span class="hljs-keyword">return</span> phase4(state);
}
exports.bootstrap = bootstrap;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseArgv</span>(<span class="hljs-params">argv, entrypointArgs</span>) </span>{
    arg !== <span class="hljs-literal">null</span> &amp;&amp; arg !== <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> ? arg : (arg = <span class="hljs-built_in">require</span>(<span class="hljs-string">'arg'</span>));
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>HACK: technically, this function is not marked @internal so it's possible
that libraries in the wild are doing <code>require('ts-node/dist/bin').main({'--transpile-only': true})</code>
We can mark this function @internal in next major release.
For now, rewrite args to avoid a breaking change.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    entrypointArgs = { ...entrypointArgs };
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">of</span> <span class="hljs-built_in">Object</span>.keys(entrypointArgs)) {
        entrypointArgs[key.replace(<span class="hljs-regexp">/([a-z])-([a-z])/g</span>, (_$<span class="hljs-number">0</span>, $<span class="hljs-number">1</span>, $<span class="hljs-number">2</span>) =&gt; <span class="hljs-string">`<span class="hljs-subst">${$<span class="hljs-number">1</span>}</span><span class="hljs-subst">${$<span class="hljs-number">2.</span>toUpperCase()}</span>`</span>)] = entrypointArgs[key];
    }
    <span class="hljs-keyword">const</span> args = {
        ...entrypointArgs,
        ...arg({
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>Node.js-like options.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-string">'--eval'</span>: <span class="hljs-built_in">String</span>,
            <span class="hljs-string">'--interactive'</span>: <span class="hljs-built_in">Boolean</span>,
            <span class="hljs-string">'--print'</span>: <span class="hljs-built_in">Boolean</span>,
            <span class="hljs-string">'--require'</span>: [<span class="hljs-built_in">String</span>],
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>CLI options.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-string">'--help'</span>: <span class="hljs-built_in">Boolean</span>,
            <span class="hljs-string">'--cwdMode'</span>: <span class="hljs-built_in">Boolean</span>,
            <span class="hljs-string">'--scriptMode'</span>: <span class="hljs-built_in">Boolean</span>,
            <span class="hljs-string">'--version'</span>: arg.COUNT,
            <span class="hljs-string">'--showConfig'</span>: <span class="hljs-built_in">Boolean</span>,
            <span class="hljs-string">'--esm'</span>: <span class="hljs-built_in">Boolean</span>,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>Project options.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-string">'--cwd'</span>: <span class="hljs-built_in">String</span>,
            <span class="hljs-string">'--files'</span>: <span class="hljs-built_in">Boolean</span>,
            <span class="hljs-string">'--compiler'</span>: <span class="hljs-built_in">String</span>,
            <span class="hljs-string">'--compilerOptions'</span>: util_2.parse,
            <span class="hljs-string">'--project'</span>: <span class="hljs-built_in">String</span>,
            <span class="hljs-string">'--ignoreDiagnostics'</span>: [<span class="hljs-built_in">String</span>],
            <span class="hljs-string">'--ignore'</span>: [<span class="hljs-built_in">String</span>],
            <span class="hljs-string">'--transpileOnly'</span>: <span class="hljs-built_in">Boolean</span>,
            <span class="hljs-string">'--transpiler'</span>: <span class="hljs-built_in">String</span>,
            <span class="hljs-string">'--swc'</span>: <span class="hljs-built_in">Boolean</span>,
            <span class="hljs-string">'--typeCheck'</span>: <span class="hljs-built_in">Boolean</span>,
            <span class="hljs-string">'--compilerHost'</span>: <span class="hljs-built_in">Boolean</span>,
            <span class="hljs-string">'--pretty'</span>: <span class="hljs-built_in">Boolean</span>,
            <span class="hljs-string">'--skipProject'</span>: <span class="hljs-built_in">Boolean</span>,
            <span class="hljs-string">'--skipIgnore'</span>: <span class="hljs-built_in">Boolean</span>,
            <span class="hljs-string">'--preferTsExts'</span>: <span class="hljs-built_in">Boolean</span>,
            <span class="hljs-string">'--logError'</span>: <span class="hljs-built_in">Boolean</span>,
            <span class="hljs-string">'--emit'</span>: <span class="hljs-built_in">Boolean</span>,
            <span class="hljs-string">'--scope'</span>: <span class="hljs-built_in">Boolean</span>,
            <span class="hljs-string">'--scopeDir'</span>: <span class="hljs-built_in">String</span>,
            <span class="hljs-string">'--noExperimentalReplAwait'</span>: <span class="hljs-built_in">Boolean</span>,
            <span class="hljs-string">'--experimentalSpecifierResolution'</span>: <span class="hljs-built_in">String</span>,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>Aliases.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-string">'-e'</span>: <span class="hljs-string">'--eval'</span>,
            <span class="hljs-string">'-i'</span>: <span class="hljs-string">'--interactive'</span>,
            <span class="hljs-string">'-p'</span>: <span class="hljs-string">'--print'</span>,
            <span class="hljs-string">'-r'</span>: <span class="hljs-string">'--require'</span>,
            <span class="hljs-string">'-h'</span>: <span class="hljs-string">'--help'</span>,
            <span class="hljs-string">'-s'</span>: <span class="hljs-string">'--script-mode'</span>,
            <span class="hljs-string">'-v'</span>: <span class="hljs-string">'--version'</span>,
            <span class="hljs-string">'-T'</span>: <span class="hljs-string">'--transpileOnly'</span>,
            <span class="hljs-string">'-H'</span>: <span class="hljs-string">'--compilerHost'</span>,
            <span class="hljs-string">'-I'</span>: <span class="hljs-string">'--ignore'</span>,
            <span class="hljs-string">'-P'</span>: <span class="hljs-string">'--project'</span>,
            <span class="hljs-string">'-C'</span>: <span class="hljs-string">'--compiler'</span>,
            <span class="hljs-string">'-D'</span>: <span class="hljs-string">'--ignoreDiagnostics'</span>,
            <span class="hljs-string">'-O'</span>: <span class="hljs-string">'--compilerOptions'</span>,
            <span class="hljs-string">'--dir'</span>: <span class="hljs-string">'--cwd'</span>,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>Support both tsc-style camelCase and node-style hypen-case for <em>all</em> flags</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-string">'--cwd-mode'</span>: <span class="hljs-string">'--cwdMode'</span>,
            <span class="hljs-string">'--script-mode'</span>: <span class="hljs-string">'--scriptMode'</span>,
            <span class="hljs-string">'--show-config'</span>: <span class="hljs-string">'--showConfig'</span>,
            <span class="hljs-string">'--compiler-options'</span>: <span class="hljs-string">'--compilerOptions'</span>,
            <span class="hljs-string">'--ignore-diagnostics'</span>: <span class="hljs-string">'--ignoreDiagnostics'</span>,
            <span class="hljs-string">'--transpile-only'</span>: <span class="hljs-string">'--transpileOnly'</span>,
            <span class="hljs-string">'--type-check'</span>: <span class="hljs-string">'--typeCheck'</span>,
            <span class="hljs-string">'--compiler-host'</span>: <span class="hljs-string">'--compilerHost'</span>,
            <span class="hljs-string">'--skip-project'</span>: <span class="hljs-string">'--skipProject'</span>,
            <span class="hljs-string">'--skip-ignore'</span>: <span class="hljs-string">'--skipIgnore'</span>,
            <span class="hljs-string">'--prefer-ts-exts'</span>: <span class="hljs-string">'--preferTsExts'</span>,
            <span class="hljs-string">'--log-error'</span>: <span class="hljs-string">'--logError'</span>,
            <span class="hljs-string">'--scope-dir'</span>: <span class="hljs-string">'--scopeDir'</span>,
            <span class="hljs-string">'--no-experimental-repl-await'</span>: <span class="hljs-string">'--noExperimentalReplAwait'</span>,
            <span class="hljs-string">'--experimental-specifier-resolution'</span>: <span class="hljs-string">'--experimentalSpecifierResolution'</span>,
        }, {
            argv,
            <span class="hljs-attr">stopAtPositional</span>: <span class="hljs-literal">true</span>,
        }),
    };
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>Only setting defaults for CLI-specific flags
Anything passed to <code>register()</code> can be <code>undefined</code>; <code>create()</code> will apply
defaults.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> { <span class="hljs-string">'--cwd'</span>: cwdArg, <span class="hljs-string">'--help'</span>: help = <span class="hljs-literal">false</span>, <span class="hljs-string">'--scriptMode'</span>: scriptMode, <span class="hljs-string">'--cwdMode'</span>: cwdMode, <span class="hljs-string">'--version'</span>: version = <span class="hljs-number">0</span>, <span class="hljs-string">'--showConfig'</span>: showConfig, <span class="hljs-string">'--require'</span>: argsRequire = [], <span class="hljs-string">'--eval'</span>: code = <span class="hljs-literal">undefined</span>, <span class="hljs-string">'--print'</span>: print = <span class="hljs-literal">false</span>, <span class="hljs-string">'--interactive'</span>: interactive = <span class="hljs-literal">false</span>, <span class="hljs-string">'--files'</span>: files, <span class="hljs-string">'--compiler'</span>: compiler, <span class="hljs-string">'--compilerOptions'</span>: compilerOptions, <span class="hljs-string">'--project'</span>: project, <span class="hljs-string">'--ignoreDiagnostics'</span>: ignoreDiagnostics, <span class="hljs-string">'--ignore'</span>: ignore, <span class="hljs-string">'--transpileOnly'</span>: transpileOnly, <span class="hljs-string">'--typeCheck'</span>: typeCheck, <span class="hljs-string">'--transpiler'</span>: transpiler, <span class="hljs-string">'--swc'</span>: swc, <span class="hljs-string">'--compilerHost'</span>: compilerHost, <span class="hljs-string">'--pretty'</span>: pretty, <span class="hljs-string">'--skipProject'</span>: skipProject, <span class="hljs-string">'--skipIgnore'</span>: skipIgnore, <span class="hljs-string">'--preferTsExts'</span>: preferTsExts, <span class="hljs-string">'--logError'</span>: logError, <span class="hljs-string">'--emit'</span>: emit, <span class="hljs-string">'--scope'</span>: scope = <span class="hljs-literal">undefined</span>, <span class="hljs-string">'--scopeDir'</span>: scopeDir = <span class="hljs-literal">undefined</span>, <span class="hljs-string">'--noExperimentalReplAwait'</span>: noExperimentalReplAwait, <span class="hljs-string">'--experimentalSpecifierResolution'</span>: experimentalSpecifierResolution, <span class="hljs-string">'--esm'</span>: esm, <span class="hljs-attr">_</span>: restArgs, } = args;
    <span class="hljs-keyword">return</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>Note: argv and restArgs may be overwritten by child process</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        argv: process.argv,
        restArgs,
        cwdArg,
        help,
        scriptMode,
        cwdMode,
        version,
        showConfig,
        argsRequire,
        code,
        print,
        interactive,
        files,
        compiler,
        compilerOptions,
        project,
        ignoreDiagnostics,
        ignore,
        transpileOnly,
        typeCheck,
        transpiler,
        swc,
        compilerHost,
        pretty,
        skipProject,
        skipIgnore,
        preferTsExts,
        logError,
        emit,
        scope,
        scopeDir,
        noExperimentalReplAwait,
        experimentalSpecifierResolution,
        esm,
    };
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">phase2</span>(<span class="hljs-params">payload</span>) </span>{
    <span class="hljs-keyword">const</span> { help, version, cwdArg, esm } = payload.parseArgvResult;
    <span class="hljs-keyword">if</span> (help) {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`
Usage: ts-node [options] [ -e script | script.ts ] [arguments]

Options:

  -e, --eval [code]               Evaluate code
  -p, --print                     Print result of \`--eval\`
  -r, --require [path]            Require a node module before execution
  -i, --interactive               Opens the REPL even if stdin does not appear to be a terminal

  --esm                           Bootstrap with the ESM loader, enabling full ESM support
  --swc                           Use the faster swc transpiler

  -h, --help                      Print CLI usage
  -v, --version                   Print module version information.  -vvv to print additional information
  --showConfig                    Print resolved configuration and exit

  -T, --transpileOnly             Use TypeScript's faster \`transpileModule\` or a third-party transpiler
  -H, --compilerHost              Use TypeScript's compiler host API
  -I, --ignore [pattern]          Override the path patterns to skip compilation
  -P, --project [path]            Path to TypeScript JSON project file
  -C, --compiler [name]           Specify a custom TypeScript compiler
  --transpiler [name]             Specify a third-party, non-typechecking transpiler
  -D, --ignoreDiagnostics [code]  Ignore TypeScript warnings by diagnostic code
  -O, --compilerOptions [opts]    JSON object to merge with compiler options

  --cwd                           Behave as if invoked within this working directory.
  --files                         Load \`files\`, \`include\` and \`exclude\` from \`tsconfig.json\` on startup
  --pretty                        Use pretty diagnostic formatter (usually enabled by default)
  --cwdMode                       Use current directory instead of &lt;script.ts&gt; for config resolution
  --skipProject                   Skip reading \`tsconfig.json\`
  --skipIgnore                    Skip \`--ignore\` checks
  --emit                          Emit output files into \`.ts-node\` directory
  --scope                         Scope compiler to files within \`scopeDir\`.  Anything outside this directory is ignored.
  --scopeDir                      Directory for \`--scope\`
  --preferTsExts                  Prefer importing TypeScript files over JavaScript files
  --logError                      Logs TypeScript errors to stderr instead of throwing exceptions
  --noExperimentalReplAwait       Disable top-level await in REPL.  Equivalent to node's --no-experimental-repl-await
  --experimentalSpecifierResolution [node|explicit]
                                  Equivalent to node's --experimental-specifier-resolution
`</span>);
        process.exit(<span class="hljs-number">0</span>);
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>Output project information.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (version === <span class="hljs-number">1</span>) {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`v<span class="hljs-subst">${index_1.VERSION}</span>`</span>);
        process.exit(<span class="hljs-number">0</span>);
    }
    <span class="hljs-keyword">const</span> cwd = cwdArg ? (<span class="hljs-number">0</span>, path_1.resolve)(cwdArg) : process.cwd();
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>If ESM is explicitly enabled through the flag, stage3 should be run in a child process
with the ESM loaders configured.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (esm)
        payload.shouldUseChildProcess = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span> {
        cwd,
    };
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">phase3</span>(<span class="hljs-params">payload</span>) </span>{
    <span class="hljs-keyword">const</span> { emit, files, pretty, transpileOnly, transpiler, noExperimentalReplAwait, typeCheck, swc, compilerHost, ignore, preferTsExts, logError, scriptMode, cwdMode, project, skipProject, skipIgnore, compiler, ignoreDiagnostics, compilerOptions, argsRequire, scope, scopeDir, esm, experimentalSpecifierResolution, } = payload.parseArgvResult;
    <span class="hljs-keyword">const</span> { cwd } = payload.phase2Result;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>NOTE: When we transition to a child process for ESM, the entry-point script determined
here might not be the one used later in <code>phase4</code>. This can happen when we execute the
original entry-point but then the process forks itself using e.g. <code>child_process.fork</code>.
We will always use the original TS project in forked processes anyway, so it is
expected and acceptable to retrieve the entry-point information here in <code>phase2</code>.
See: https://github.com/TypeStrong/ts-node/issues/1812.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> { entryPointPath } = getEntryPointInfo(payload);
    <span class="hljs-keyword">const</span> preloadedConfig = (<span class="hljs-number">0</span>, configuration_1.findAndReadConfig)({
        cwd,
        emit,
        files,
        pretty,
        <span class="hljs-attr">transpileOnly</span>: (transpileOnly !== <span class="hljs-literal">null</span> &amp;&amp; transpileOnly !== <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> ? transpileOnly : transpiler != <span class="hljs-literal">null</span>) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">undefined</span>,
        <span class="hljs-attr">experimentalReplAwait</span>: noExperimentalReplAwait ? <span class="hljs-literal">false</span> : <span class="hljs-literal">undefined</span>,
        typeCheck,
        transpiler,
        swc,
        compilerHost,
        ignore,
        logError,
        <span class="hljs-attr">projectSearchDir</span>: getProjectSearchDir(cwd, scriptMode, cwdMode, entryPointPath),
        project,
        skipProject,
        skipIgnore,
        compiler,
        ignoreDiagnostics,
        compilerOptions,
        <span class="hljs-attr">require</span>: argsRequire,
        scope,
        scopeDir,
        preferTsExts,
        esm,
        <span class="hljs-attr">experimentalSpecifierResolution</span>: experimentalSpecifierResolution,
    });
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>If ESM is enabled through the parsed tsconfig, stage4 should be run in a child
process with the ESM loaders configured.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (preloadedConfig.options.esm)
        payload.shouldUseChildProcess = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span> { preloadedConfig };
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<div class="dox">
<div class="summary">
<p>Determines the entry-point information from the argv and phase2 result. This
method will be invoked in two places:</p>
</div>
<div class="body">
<ol>
<li>In phase 3 to be able to find a project from the potential entry-point script.</li>
<li>In phase 4 to determine the actual entry-point script.</li>
</ol>
<p>Note that we need to explicitly re-resolve the entry-point information in the final
stage because the previous stage information could be modified when the bootstrap
invocation transitioned into a child process for ESM.</p>
<p>Stages before (phase 4) can and will be cached by the child process through the Brotli
configuration and entry-point information is only reliable in the final phase. More
details can be found in here: https://github.com/TypeStrong/ts-node/issues/1812.</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getEntryPointInfo</span>(<span class="hljs-params">state</span>) </span>{
    <span class="hljs-keyword">const</span> { code, interactive, restArgs } = state.parseArgvResult;
    <span class="hljs-keyword">const</span> { cwd } = state.phase2Result;
    <span class="hljs-keyword">const</span> { isCli } = state;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>Figure out which we are executing: piped stdin, --eval, REPL, and/or entrypoint
This is complicated because node's behavior is complicated
<code>node -e code -i ./script.js</code> ignores -e</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> executeEval = code != <span class="hljs-literal">null</span> &amp;&amp; !(interactive &amp;&amp; restArgs.length);
    <span class="hljs-keyword">const</span> executeEntrypoint = !executeEval &amp;&amp; restArgs.length &gt; <span class="hljs-number">0</span>;
    <span class="hljs-keyword">const</span> executeRepl = !executeEntrypoint &amp;&amp;
        (interactive || (process.stdin.isTTY &amp;&amp; !executeEval));
    <span class="hljs-keyword">const</span> executeStdin = !executeEval &amp;&amp; !executeRepl &amp;&amp; !executeEntrypoint;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<div class="dox">
<div class="summary">
<p>Unresolved. May point to a symlink, not realpath. May be missing file extension
NOTE: resolution relative to cwd option (not <code>process.cwd()</code>) is legacy backwards-compat; should be changed in next major: https://github.com/TypeStrong/ts-node/issues/1834</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> entryPointPath = executeEntrypoint
        ? isCli
            ? (<span class="hljs-number">0</span>, path_1.resolve)(cwd, restArgs[<span class="hljs-number">0</span>])
            : (<span class="hljs-number">0</span>, path_1.resolve)(restArgs[<span class="hljs-number">0</span>])
        : <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">return</span> {
        executeEval,
        executeEntrypoint,
        executeRepl,
        executeStdin,
        entryPointPath,
    };
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">phase4</span>(<span class="hljs-params">payload</span>) </span>{
    <span class="hljs-keyword">var</span> _a, _b, _c, _d, _e, _f, _g;
    <span class="hljs-keyword">const</span> { isInChildProcess, tsNodeScript } = payload;
    <span class="hljs-keyword">const</span> { version, showConfig, restArgs, code, print, argv } = payload.parseArgvResult;
    <span class="hljs-keyword">const</span> { cwd } = payload.phase2Result;
    <span class="hljs-keyword">const</span> { preloadedConfig } = payload.phase3Result;
    <span class="hljs-keyword">const</span> { entryPointPath, executeEntrypoint, executeEval, executeRepl, executeStdin, } = getEntryPointInfo(payload);
    <span class="hljs-keyword">let</span> evalStuff;
    <span class="hljs-keyword">let</span> replStuff;
    <span class="hljs-keyword">let</span> stdinStuff;
    <span class="hljs-keyword">let</span> evalAwarePartialHost = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">if</span> (executeEval) {
        <span class="hljs-keyword">const</span> state = <span class="hljs-keyword">new</span> repl_1.EvalState((<span class="hljs-number">0</span>, path_1.join)(cwd, repl_1.EVAL_FILENAME));
        evalStuff = {
            state,
            <span class="hljs-attr">repl</span>: (<span class="hljs-number">0</span>, repl_1.createRepl)({
                state,
                <span class="hljs-attr">composeWithEvalAwarePartialHost</span>: evalAwarePartialHost,
                <span class="hljs-attr">ignoreDiagnosticsThatAreAnnoyingInInteractiveRepl</span>: <span class="hljs-literal">false</span>,
            }),
        };
        ({ evalAwarePartialHost } = evalStuff.repl);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>Create a local module instance based on <code>cwd</code>.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">const</span> <span class="hljs-built_in">module</span> = (evalStuff.module = <span class="hljs-keyword">new</span> Module(repl_1.EVAL_NAME));
        <span class="hljs-built_in">module</span>.filename = evalStuff.state.path;
        <span class="hljs-built_in">module</span>.paths = Module._nodeModulePaths(cwd);
    }
    <span class="hljs-keyword">if</span> (executeStdin) {
        <span class="hljs-keyword">const</span> state = <span class="hljs-keyword">new</span> repl_1.EvalState((<span class="hljs-number">0</span>, path_1.join)(cwd, repl_1.STDIN_FILENAME));
        stdinStuff = {
            state,
            <span class="hljs-attr">repl</span>: (<span class="hljs-number">0</span>, repl_1.createRepl)({
                state,
                <span class="hljs-attr">composeWithEvalAwarePartialHost</span>: evalAwarePartialHost,
                <span class="hljs-attr">ignoreDiagnosticsThatAreAnnoyingInInteractiveRepl</span>: <span class="hljs-literal">false</span>,
            }),
        };
        ({ evalAwarePartialHost } = stdinStuff.repl);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>Create a local module instance based on <code>cwd</code>.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">const</span> <span class="hljs-built_in">module</span> = (stdinStuff.module = <span class="hljs-keyword">new</span> Module(repl_1.STDIN_NAME));
        <span class="hljs-built_in">module</span>.filename = stdinStuff.state.path;
        <span class="hljs-built_in">module</span>.paths = Module._nodeModulePaths(cwd);
    }
    <span class="hljs-keyword">if</span> (executeRepl) {
        <span class="hljs-keyword">const</span> state = <span class="hljs-keyword">new</span> repl_1.EvalState((<span class="hljs-number">0</span>, path_1.join)(cwd, repl_1.REPL_FILENAME));
        replStuff = {
            state,
            <span class="hljs-attr">repl</span>: (<span class="hljs-number">0</span>, repl_1.createRepl)({
                state,
                <span class="hljs-attr">composeWithEvalAwarePartialHost</span>: evalAwarePartialHost,
            }),
        };
        ({ evalAwarePartialHost } = replStuff.repl);
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>Register the TypeScript compiler instance.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> service = (<span class="hljs-number">0</span>, index_1.createFromPreloadedConfig)({
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>Since this struct may have been marshalled across thread or process boundaries, we must restore
un-marshall-able values.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        ...preloadedConfig,
        <span class="hljs-attr">options</span>: {
            ...preloadedConfig.options,
            <span class="hljs-attr">readFile</span>: (_a = evalAwarePartialHost === <span class="hljs-literal">null</span> || evalAwarePartialHost === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> ? <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> : evalAwarePartialHost.readFile) !== <span class="hljs-literal">null</span> &amp;&amp; _a !== <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> ? _a : <span class="hljs-literal">undefined</span>,
            <span class="hljs-attr">fileExists</span>: (_b = evalAwarePartialHost === <span class="hljs-literal">null</span> || evalAwarePartialHost === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> ? <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> : evalAwarePartialHost.fileExists) !== <span class="hljs-literal">null</span> &amp;&amp; _b !== <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> ? _b : <span class="hljs-literal">undefined</span>,
            <span class="hljs-attr">tsTrace</span>: index_1.DEFAULTS.tsTrace,
        },
    });
    (<span class="hljs-number">0</span>, index_1.register)(service);
    <span class="hljs-keyword">if</span> (isInChildProcess)
        <span class="hljs-built_in">require</span>(<span class="hljs-string">'./child/child-loader'</span>).lateBindHooks((<span class="hljs-number">0</span>, index_1.createEsmHooks)(service));
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>Bind REPL service to ts-node compiler service (chicken-and-egg problem)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    replStuff === <span class="hljs-literal">null</span> || replStuff === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> ? <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> : replStuff.repl.setService(service);
    evalStuff === <span class="hljs-literal">null</span> || evalStuff === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> ? <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> : evalStuff.repl.setService(service);
    stdinStuff === <span class="hljs-literal">null</span> || stdinStuff === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> ? <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> : stdinStuff.repl.setService(service);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>Output project information.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (version === <span class="hljs-number">2</span>) {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`ts-node v<span class="hljs-subst">${index_1.VERSION}</span>`</span>);
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`node <span class="hljs-subst">${process.version}</span>`</span>);
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`compiler v<span class="hljs-subst">${service.ts.version}</span>`</span>);
        process.exit(<span class="hljs-number">0</span>);
    }
    <span class="hljs-keyword">if</span> (version &gt;= <span class="hljs-number">3</span>) {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`ts-node v<span class="hljs-subst">${index_1.VERSION}</span> <span class="hljs-subst">${(<span class="hljs-number">0</span>, path_1.dirname)(__dirname)}</span>`</span>);
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`node <span class="hljs-subst">${process.version}</span>`</span>);
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`compiler v<span class="hljs-subst">${service.ts.version}</span> <span class="hljs-subst">${(_c = service.compilerPath) !== <span class="hljs-literal">null</span> &amp;&amp; _c !== <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> ? _c : <span class="hljs-string">''</span>}</span>`</span>);
        process.exit(<span class="hljs-number">0</span>);
    }
    <span class="hljs-keyword">if</span> (showConfig) {
        <span class="hljs-keyword">const</span> ts = service.ts;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> ts.convertToTSConfig !== <span class="hljs-string">'function'</span>) {
            <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Error: --showConfig requires a typescript versions &gt;=3.2 that support --showConfig'</span>);
            process.exit(<span class="hljs-number">1</span>);
        }
        <span class="hljs-keyword">let</span> moduleTypes = <span class="hljs-literal">undefined</span>;
        <span class="hljs-keyword">if</span> (service.options.moduleTypes) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>Assumption: this codepath requires CLI invocation, so moduleTypes must have come from a tsconfig, not API.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">const</span> showRelativeTo = (<span class="hljs-number">0</span>, path_1.dirname)(service.configFilePath);
            moduleTypes = {};
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, value] <span class="hljs-keyword">of</span> <span class="hljs-built_in">Object</span>.entries(service.options.moduleTypes)) {
                moduleTypes[(<span class="hljs-number">0</span>, path_1.relative)(showRelativeTo, (<span class="hljs-number">0</span>, path_1.resolve)((_d = service.options.optionBasePaths) === <span class="hljs-literal">null</span> || _d === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> ? <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> : _d.moduleTypes, key))] = value;
            }
        }
        <span class="hljs-keyword">const</span> json = {
            [<span class="hljs-string">'ts-node'</span>]: {
                ...service.options,
                <span class="hljs-attr">require</span>: ((_e = service.options.require) === <span class="hljs-literal">null</span> || _e === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> ? <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> : _e.length)
                    ? service.options.require
                    : <span class="hljs-literal">undefined</span>,
                moduleTypes,
                <span class="hljs-attr">optionBasePaths</span>: <span class="hljs-literal">undefined</span>,
                <span class="hljs-attr">compilerOptions</span>: <span class="hljs-literal">undefined</span>,
                <span class="hljs-attr">project</span>: (_f = service.configFilePath) !== <span class="hljs-literal">null</span> &amp;&amp; _f !== <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> ? _f : service.options.project,
            },
            ...ts.convertToTSConfig(service.config, (_g = service.configFilePath) !== <span class="hljs-literal">null</span> &amp;&amp; _g !== <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> ? _g : (<span class="hljs-number">0</span>, path_1.join)(cwd, <span class="hljs-string">'ts-node-implicit-tsconfig.json'</span>), service.ts.sys),
        };
        <span class="hljs-built_in">console</span>.log(
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<p>Assumes that all configuration options which can possibly be specified via the CLI are JSON-compatible.
If, in the future, we must log functions, for example readFile and fileExists, then we can implement a JSON
replacer function.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-built_in">JSON</span>.stringify(json, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>));
        process.exit(<span class="hljs-number">0</span>);
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<p>Prepend <code>ts-node</code> arguments to CLI for child processes.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    process.execArgv.push(tsNodeScript, ...argv.slice(<span class="hljs-number">2</span>, argv.length - restArgs.length));
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>TODO this comes from BootstrapState</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    process.argv = [process.argv[<span class="hljs-number">1</span>]]
        .concat(executeEntrypoint ? [entryPointPath] : [])
        .concat(restArgs.slice(executeEntrypoint ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>));
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<p>Execute the main contents (either eval, script or piped).</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (executeEntrypoint) {
        <span class="hljs-keyword">if</span> (payload.isInChildProcess &amp;&amp;
            (<span class="hljs-number">0</span>, util_2.versionGteLt)(process.versions.node, <span class="hljs-string">'18.6.0'</span>)) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>HACK workaround node regression</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-built_in">require</span>(<span class="hljs-string">'../dist-raw/runmain-hack.js'</span>).run(entryPointPath);
        }
        <span class="hljs-keyword">else</span> {
            Module.runMain();
        }
    }
    <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<p>Note: eval and repl may both run, but never with stdin.
If stdin runs, eval and repl will not.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (executeEval) {
            (<span class="hljs-number">0</span>, node_internal_modules_cjs_helpers_1.addBuiltinLibsToObject)(global);
            evalAndExitOnTsError(evalStuff.repl, evalStuff.module, code, print, <span class="hljs-string">'eval'</span>);
        }
        <span class="hljs-keyword">if</span> (executeRepl) {
            replStuff.repl.start();
        }
        <span class="hljs-keyword">if</span> (executeStdin) {
            <span class="hljs-keyword">let</span> buffer = code || <span class="hljs-string">''</span>;
            process.stdin.on(<span class="hljs-string">'data'</span>, (chunk) =&gt; (buffer += chunk));
            process.stdin.on(<span class="hljs-string">'end'</span>, () =&gt; {
                evalAndExitOnTsError(stdinStuff.repl, stdinStuff.module, buffer, 
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<p><code>echo 123 | node -p</code> still prints 123</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                print, <span class="hljs-string">'stdin'</span>);
            });
        }
    }
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<div class="dox">
<div class="summary">
<p>Get project search path from args.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getProjectSearchDir</span>(<span class="hljs-params">cwd, scriptMode, cwdMode, scriptPath</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<p>Validate <code>--script-mode</code> / <code>--cwd-mode</code> / <code>--cwd</code> usage is correct.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (scriptMode &amp;&amp; cwdMode) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'--cwd-mode cannot be combined with --script-mode'</span>);
    }
    <span class="hljs-keyword">if</span> (scriptMode &amp;&amp; !scriptPath) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'--script-mode must be used with a script name, e.g. `ts-node --script-mode &lt;script.ts&gt;`'</span>);
    }
    <span class="hljs-keyword">const</span> doScriptMode = scriptMode === <span class="hljs-literal">true</span> ? <span class="hljs-literal">true</span> : cwdMode === <span class="hljs-literal">true</span> ? <span class="hljs-literal">false</span> : !!scriptPath;
    <span class="hljs-keyword">if</span> (doScriptMode) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36"></a>
</div>
<p>Use node's own resolution behavior to ensure we follow symlinks.
scriptPath may omit file extension or point to a directory with or without package.json.
This happens before we are registered, so we tell node's resolver to consider ts, tsx, and jsx files.
In extremely rare cases, is is technically possible to resolve the wrong directory,
because we do not yet know preferTsExts, jsx, nor allowJs.
See also, justification why this will not happen in real-world situations:
https://github.com/TypeStrong/ts-node/pull/1009#issuecomment-613017081</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">const</span> exts = [<span class="hljs-string">'.js'</span>, <span class="hljs-string">'.jsx'</span>, <span class="hljs-string">'.ts'</span>, <span class="hljs-string">'.tsx'</span>];
        <span class="hljs-keyword">const</span> extsTemporarilyInstalled = [];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> ext <span class="hljs-keyword">of</span> exts) {
            <span class="hljs-keyword">if</span> (!(<span class="hljs-number">0</span>, util_2.hasOwnProperty)(<span class="hljs-built_in">require</span>.extensions, ext)) {
                extsTemporarilyInstalled.push(ext);
                <span class="hljs-built_in">require</span>.extensions[ext] = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ };
            }
        }
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, path_1.dirname)(requireResolveNonCached(scriptPath));
        }
        <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> ext <span class="hljs-keyword">of</span> extsTemporarilyInstalled) {
                <span class="hljs-keyword">delete</span> <span class="hljs-built_in">require</span>.extensions[ext];
            }
        }
    }
    <span class="hljs-keyword">return</span> cwd;
}
<span class="hljs-keyword">const</span> guaranteedNonexistentDirectoryPrefix = (<span class="hljs-number">0</span>, path_1.resolve)(__dirname, <span class="hljs-string">'doesnotexist'</span>);
<span class="hljs-keyword">let</span> guaranteedNonexistentDirectorySuffix = <span class="hljs-number">0</span>;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<div class="dox">
<div class="summary">
<p>require.resolve an absolute path, tricking node into <em>not</em> caching the results.
Necessary so that we do not pollute require.resolve cache prior to installing require.extensions</p>
</div>
<div class="body">
<p>Is a terrible hack, because node does not expose the necessary cache invalidation APIs
https://stackoverflow.com/questions/59865584/how-to-invalidate-cached-require-resolve-results</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">requireResolveNonCached</span>(<span class="hljs-params">absoluteModuleSpecifier</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38"></a>
</div>
<p>node &lt;= 12.1.x fallback: The trick below triggers a node bug on old versions.
On these old versions, pollute the require cache instead. This is a deliberate
ts-node limitation that will <em>rarely</em> manifest, and will not matter once node 12
is end-of-life'd on 2022-04-30</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> isSupportedNodeVersion = (<span class="hljs-number">0</span>, util_2.versionGteLt)(process.versions.node, <span class="hljs-string">'12.2.0'</span>);
    <span class="hljs-keyword">if</span> (!isSupportedNodeVersion)
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">require</span>.resolve(absoluteModuleSpecifier);
    <span class="hljs-keyword">const</span> { dir, base } = (<span class="hljs-number">0</span>, path_1.parse)(absoluteModuleSpecifier);
    <span class="hljs-keyword">const</span> relativeModuleSpecifier = <span class="hljs-string">`./<span class="hljs-subst">${base}</span>`</span>;
    <span class="hljs-keyword">const</span> req = (<span class="hljs-number">0</span>, util_2.createRequire)((<span class="hljs-number">0</span>, path_1.join)(dir, <span class="hljs-string">'imaginaryUncacheableRequireResolveScript'</span>));
    <span class="hljs-keyword">return</span> req.resolve(relativeModuleSpecifier, {
        <span class="hljs-attr">paths</span>: [
            <span class="hljs-string">`<span class="hljs-subst">${guaranteedNonexistentDirectoryPrefix}</span><span class="hljs-subst">${guaranteedNonexistentDirectorySuffix++}</span>`</span>,
            ...(req.resolve.paths(relativeModuleSpecifier) || []),
        ],
    });
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<div class="dox">
<div class="summary">
<p>Evaluate an [eval] or [stdin] script</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">evalAndExitOnTsError</span>(<span class="hljs-params">replService, module, code, isPrinted, filenameAndDirname</span>) </span>{
    <span class="hljs-keyword">let</span> result;
    (<span class="hljs-number">0</span>, repl_1.setupContext)(global, <span class="hljs-built_in">module</span>, filenameAndDirname);
    <span class="hljs-keyword">try</span> {
        result = replService.evalCode(code);
    }
    <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-keyword">if</span> (error <span class="hljs-keyword">instanceof</span> index_1.TSError) {
            <span class="hljs-built_in">console</span>.error(error);
            process.exit(<span class="hljs-number">1</span>);
        }
        <span class="hljs-keyword">throw</span> error;
    }
    <span class="hljs-keyword">if</span> (isPrinted) {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">typeof</span> result === <span class="hljs-string">'string'</span>
            ? result
            : (<span class="hljs-number">0</span>, util_1.inspect)(result, { <span class="hljs-attr">colors</span>: process.stdout.isTTY }));
    }
}
<span class="hljs-keyword">if</span> (<span class="hljs-built_in">require</span>.main === <span class="hljs-built_in">module</span>) {
    main();
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="sourcemappingurlbin.js.map">
  <h1>
    <a href="#sourcemappingurlbin.js.map" name="sourcemappingurlbin.js.map" class="pilcrow"></a>
sourceMappingURL=bin.js.map
  </h1>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"></pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
