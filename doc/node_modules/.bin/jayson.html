<!DOCTYPE html>
<html>
<head>
  <title>jayson</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/.bin/jayson";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>jayson</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">#!/usr/bin/env node</span>

<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);
<span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);

<span class="hljs-keyword">const</span> pkg = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../package.json'</span>);
<span class="hljs-keyword">const</span> jayson = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../'</span>);
<span class="hljs-keyword">const</span> program = <span class="hljs-built_in">require</span>(<span class="hljs-string">'commander'</span>);
<span class="hljs-keyword">const</span> eyes = <span class="hljs-built_in">require</span>(<span class="hljs-string">'eyes'</span>);
<span class="hljs-keyword">const</span> net = <span class="hljs-built_in">require</span>(<span class="hljs-string">'net'</span>)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>initialize program and define arguments</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">program.version(pkg.version)
       .option(<span class="hljs-string">'-m, --method [name]'</span>, <span class="hljs-string">'Method'</span>, <span class="hljs-built_in">String</span>)
       .option(<span class="hljs-string">'-p, --params [json]'</span>, <span class="hljs-string">'Array or Object to use as parameters'</span>, <span class="hljs-built_in">JSON</span>.parse)
       .option(<span class="hljs-string">'-u, --url [url]'</span>, <span class="hljs-string">'URL to server'</span>, url.parse)
       .option(<span class="hljs-string">'-q, --quiet'</span>, <span class="hljs-string">'Only output the response value and any errors'</span>, <span class="hljs-built_in">Boolean</span>)
       .option(<span class="hljs-string">'-s, --socket [path] or [ip:port]'</span>, <span class="hljs-string">'Path to UNIX socket, or TCP socket address'</span>, parseSocket)
       .option(<span class="hljs-string">'-j, --json'</span>, <span class="hljs-string">'Only output the response value as JSON (implies --quiet)'</span>)
       .option(<span class="hljs-string">'-c, --color'</span>, <span class="hljs-string">'Color output'</span>, <span class="hljs-built_in">Boolean</span>)
       .parse(process.argv);

<span class="hljs-keyword">const</span> inspect = eyes.inspector({
  <span class="hljs-attr">stream</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">styles</span>: program.color ? eyes.defaults.styles : {<span class="hljs-attr">all</span>: <span class="hljs-literal">false</span>}
});

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>quiet is implied if json is specified</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">if</span>(program.json) program.quiet = <span class="hljs-literal">true</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>wrapper for printing different kinds of output</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> std = {
  <span class="hljs-attr">out</span>: getPrinter({ <span class="hljs-attr">fn</span>: <span class="hljs-built_in">console</span>.log }),
  <span class="hljs-attr">err</span>: getPrinter({ <span class="hljs-attr">fn</span>: <span class="hljs-built_in">console</span>.error })
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>do we have all arguments required to do something?</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">if</span>(!(program.method &amp;&amp; (program.url || program.socket))) {
  std.err.result(program.helpInformation());
  <span class="hljs-keyword">return</span> process.exit(<span class="hljs-number">-1</span>);
}

<span class="hljs-keyword">const</span> client = (program.socket &amp;&amp; program.socket.host)
  ? jayson.client.tcp(program.socket)
  : (program.url &amp;&amp; program.url.protocol == <span class="hljs-string">'https:'</span>)
    ? jayson.client.https(program.url || program.socket)
    : jayson.client.http(program.url || program.socket);

std.out.noise(
  colorize(<span class="hljs-string">'magenta'</span>, <span class="hljs-string">'-&gt; %s(%s)'</span>),
  program.method,
  <span class="hljs-built_in">Array</span>.isArray(program.params) ? program.params.join(<span class="hljs-string">', '</span>) : <span class="hljs-built_in">JSON</span>.stringify(program.params)
);

client.request(program.method, program.params, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, response</span>) </span>{
  <span class="hljs-keyword">if</span>(err) {
    std.err.noise(colorize(<span class="hljs-string">'red'</span>, <span class="hljs-string">'&lt;- %s'</span>), err.stack);
    <span class="hljs-keyword">return</span> process.exit(<span class="hljs-number">-1</span>);
  }
       
  <span class="hljs-keyword">if</span>(!response) {
    std.err.noise(colorize(<span class="hljs-string">'red'</span>, <span class="hljs-string">'&lt;- %s'</span>), <span class="hljs-string">'empty response'</span>);
    <span class="hljs-keyword">return</span> process.exit(<span class="hljs-number">-1</span>);
  }    

  <span class="hljs-keyword">if</span>(program.json) {
    std.out.result(<span class="hljs-string">'%s'</span>, <span class="hljs-built_in">JSON</span>.stringify(response).replace(<span class="hljs-string">"\n"</span>, <span class="hljs-string">""</span>));
    <span class="hljs-keyword">return</span> process.exit(<span class="hljs-number">0</span>);
  }

  std.out.noise(<span class="hljs-string">'&lt;- %s'</span>, inspect(response), <span class="hljs-literal">true</span>);
  process.exit(response.error ? response.error.code : <span class="hljs-number">0</span>);
});

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseSocket</span>(<span class="hljs-params">value</span>) </span>{
  <span class="hljs-keyword">const</span> addr = value.split(<span class="hljs-string">":"</span>);

  <span class="hljs-keyword">if</span> (addr.length == <span class="hljs-number">2</span> &amp;&amp; (net.isIP(addr[<span class="hljs-number">0</span>]) || addr[<span class="hljs-number">0</span>].toLowerCase() == <span class="hljs-string">"localhost"</span>)) {
    <span class="hljs-keyword">return</span> {<span class="hljs-attr">port</span>: addr[<span class="hljs-number">1</span>], <span class="hljs-attr">host</span>: addr[<span class="hljs-number">0</span>]};
  }

  <span class="hljs-keyword">return</span> {<span class="hljs-attr">socketPath</span>: path.normalize(value)};
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">colorize</span>(<span class="hljs-params">color, format</span>) </span>{
  <span class="hljs-keyword">return</span> program.color
       ? eyes.stylize(format, color, {}) 
       : format;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPrinter</span>(<span class="hljs-params">options</span>) </span>{

  <span class="hljs-keyword">const</span> fn = options.fn || <span class="hljs-built_in">console</span>.log;

  <span class="hljs-keyword">return</span> {

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>print noise (printed if program is not quiet)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    noise: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">if</span>(program.quiet) <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">return</span> fn.apply(<span class="hljs-built_in">console</span>, <span class="hljs-built_in">arguments</span>);
    },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>print results (always printed)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    result: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> fn.apply(<span class="hljs-built_in">console</span>, <span class="hljs-built_in">arguments</span>);
    }
  
  };
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
